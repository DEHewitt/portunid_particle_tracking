# Simulating larval dispersal of portunid crabs
This repository stores all code/files used for simulation and analysis of particle tracking experiments described in [Hewitt et al., 2022](https://doi.org/10.1111/fog.12608) and [Schilling et al. 2022](https://doi.org/10.1071/MF21348). These experiments were run on the [UNSW High Performance Cluster (Katana)](https://research.unsw.edu.au/katana). Briefly, these studies simulate larval dispersal of Giant Mud Crab (*Scylla serrata*), Blue Swimmer Crab (*Portunus armatus*) and Spanner Crab (*Ranina ranina*) to assess population connectivity along the east Australian coast.

Particle tracking is conducted in `Python` using [PARCELS](https://github.com/OceanParcels/parcels), all output is then processed in `R`.

Jobs are submitted using the `.pbs` scripts in the Simulations folder, and are separate for each species/direction combination. The workflow includes multiple job submissions and follows this order:

1. Submit the particle tracking job with the appropriate `.pbs`. These are named in a _species_direction_`.pbs` format, so to run backwards simulations for Giant Mud Crab you'd submit `gmc_backwards.pbs` to Katana. Depending on the direction and species these jobs get split up in different ways (to manage memory/computation time), unless you intend to change the structure of the workflow this _shouldn't_ matter.
2. Once particle tracking simulations are complete we need to introduce some biology to our particles (e.g., growth rates, settlement). This is achieved by running the `R` script `portunid_particle_processing.R` which uses a range of functions stored in the `R` folder. This script is set up to do different things for different species/directions, so we need to submit the appropriate `_processing.pbs` (prefixed by our _species_direction_ combination) to tell this script which species we're working on. So, to continue our backwards Giant Mud Crab analysis we'd submit `gmc_backwards_processing.pbs`
3. No we're ready to bring all of the output together (remember the splitting up in step 1). We do this by submitting the appropriate `_join.pbs`, prefixed by _species_direction_ (e.g., `gmc_backwards_join.pbs`).
4. Now we have our fully processed particle trajectories - ready for analysis. The analysis described in [Hewitt et al. (2022)](https://doi.org/10.1111/fog.12608) is carried out by submitting the `R` script `portunid_particle_analysis_plotting.R` which is called via `portunid_particle_plotting.pbs` (note this runs the analysis for both Giant Mud Crab and Blue Swimmer Crab). All code for the analysis described in [Schilling et al. (2022)](https://doi.org/10.1071/MF21348) can be found in the `BRAN_2020` folder.
